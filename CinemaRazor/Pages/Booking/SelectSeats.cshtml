@page
@model CinemaRazor.Pages.Booking.SelectSeatsModel

@{
    ViewData["Title"] = "–í—ã–±–æ—Ä –º–µ—Å—Ç–∞";
}

<h1>üé¨ @Model.Session.Movie.Title</h1>
<p class="lead">
    <strong>–°–µ–∞–Ω—Å:</strong> @Model.Session.StartTime.ToString("dd.MM.yyyy HH:mm") | 
    <strong>–¶–µ–Ω–∞:</strong> @Model.Session.Price.ToString("0") BYN
</p>

<hr />

<div class="mb-4">
    <h4>–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ:</h4>
    <div class="d-flex gap-3 mb-3">
        <div>
            <span class="seat-circle available"></span> –°–≤–æ–±–æ–¥–Ω–æ
        </div>
        <div>
            <span class="seat-circle occupied"></span> –ó–∞–Ω—è—Ç–æ
        </div>
        <div>
            <span class="seat-circle selected"></span> –í—ã–±—Ä–∞–Ω–æ
        </div>
    </div>
</div>

<div class="cinema-screen mb-4">
    <div class="screen-label">–≠–ö–†–ê–ù</div>
</div>

<div class="seats-container">
    @for (int row = 1; row <= Model.MaxRow; row++)
    {
        <div class="seat-row">
            <div class="row-label">–†—è–¥ @row</div>
            <div class="seats">
                @for (int seatNum = 1; seatNum <= Model.MaxSeatInRow; seatNum++)
                {
                    var seat = Model.AllSeats.FirstOrDefault(s => s.RowNumber == row && s.SeatNumber == seatNum);
                    if (seat != null)
                    {
                        var isOccupied = Model.OccupiedSeatIds.Contains(seat.Id);
                        var seatClass = isOccupied ? "occupied" : "available";
                        
                        <button type="button" 
                                class="seat-circle @seatClass" 
                                data-seat-id="@seat.Id"
                                data-row="@row"
                                data-seat="@seatNum"
                                @(isOccupied ? "disabled" : "")
                                onclick="selectSeat(this)">
                            @seatNum
                        </button>
                    }
                    else
                    {
                        <div class="seat-circle invisible">-</div>
                    }
                }
            </div>
        </div>
    }
</div>

<div class="mt-4">
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">–í—ã–±—Ä–∞–Ω–Ω–æ–µ –º–µ—Å—Ç–æ:</h5>
            <p id="selected-info" class="mb-3">–ú–µ—Å—Ç–æ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ</p>
            <form method="post">
                <input type="hidden" name="SessionId" value="@Model.Session.Id" />
                <input type="hidden" name="SeatId" id="selected-seat-id" value="" />
                <button type="submit" id="book-btn" class="btn btn-success" disabled>
                    –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –º–µ—Å—Ç–æ
                </button>
                <a asp-page="./Index" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
            </form>
        </div>
    </div>
</div>

<style>
    .cinema-screen {
        width: 100%;
        text-align: center;
        margin-bottom: 30px;
    }

    .screen-label {
        background: linear-gradient(to bottom, #333, #555);
        color: white;
        padding: 15px;
        border-radius: 10px 10px 0 0;
        font-weight: bold;
        max-width: 600px;
        margin: 0 auto;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    .seats-container {
        max-width: 900px;
        margin: 0 auto;
    }

    .seat-row {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
    }

    .row-label {
        min-width: 80px;
        font-weight: bold;
        color: #666;
    }

    .seats {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }

    .seat-circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 2px solid #ddd;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .seat-circle.available {
        background-color: #28a745;
        color: white;
        border-color: #28a745;
    }

    .seat-circle.available:hover {
        background-color: #218838;
        transform: scale(1.1);
    }

    .seat-circle.occupied {
        background-color: #dc3545;
        color: white;
        border-color: #dc3545;
        cursor: not-allowed;
    }

    .seat-circle.selected {
        background-color: #0d6efd;
        color: #fff;
        border-color: #0a58ca;
        transform: scale(1.15);
        box-shadow: 0 0 14px rgba(13, 110, 253, 0.45);
    }

    .seat-circle.invisible {
        opacity: 0;
        cursor: default;
    }

    .legend {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }
</style>

<script>
    let selectedSeatId = null;

    function selectSeat(button) {
        // –°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–µ—Å—Ç–∞
        document.querySelectorAll('.seat-circle.selected').forEach(seat => {
            seat.classList.remove('selected');
            seat.classList.add('available');
        });

        // –í—ã–¥–µ–ª–∏—Ç—å –Ω–æ–≤–æ–µ –º–µ—Å—Ç–æ
        button.classList.remove('available');
        button.classList.add('selected');

        selectedSeatId = button.getAttribute('data-seat-id');
        const row = button.getAttribute('data-row');
        const seat = button.getAttribute('data-seat');

        // –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –º–µ—Å—Ç–µ
        document.getElementById('selected-info').innerText = `–†—è–¥ ${row}, –ú–µ—Å—Ç–æ ${seat}`;
        document.getElementById('selected-seat-id').value = selectedSeatId;
        document.getElementById('book-btn').disabled = false;
    }
</script>
