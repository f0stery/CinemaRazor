@page
@model CinemaRazor.Pages.Sessions.DetailsModel

@{
    ViewData["Title"] = "Детали сеанса";
}

<section class="page-header mb-4">
    <h1 class="page-title">Детали сеанса</h1>
    <p class="page-subtitle">Просмотр подробной информации о сеансе и схемы зала</p>
</section>

<div class="details-container mb-4">
    <div class="details-header">
        <h2 class="details-title">@Model.Session.Movie.Title</h2>
        <p class="details-subtitle">Сеанс в основном зале</p>
    </div>

    <div class="details-row">
        <div class="details-label">Время начала:</div>
        <div class="details-value">@Model.Session.StartTime.ToString("dd.MM.yyyy HH:mm")</div>
    </div>

    <div class="details-row">
        <div class="details-label">Время окончания:</div>
        <div class="details-value">@Model.Session.EndTime.ToString("dd.MM.yyyy HH:mm")</div>
    </div>

    <div class="details-row">
        <div class="details-label">Цена билета:</div>
        <div class="details-value">
            <span class="price-badge">@Model.Session.Price.ToString("0") BYN</span>
        </div>
    </div>

    <div class="details-row">
        <div class="details-label">Статистика мест:</div>
        <div class="details-value">
            <span class="badge bg-light text-dark me-2">Всего: @Model.TotalSeats</span>
            <span class="badge bg-success me-2">Свободно: @Model.AvailableSeats</span>
            <span class="badge bg-danger">Занято: @Model.OccupiedSeats</span>
        </div>
    </div>

    <div class="details-actions">
        <a asp-page="/Tickets/Create" asp-route-SessionId="@Model.Session.Id" class="btn btn-primary">Продать билет</a>
        <a asp-page="./Edit" asp-route-id="@Model.Session.Id" class="btn btn-outline-primary">Редактировать</a>
        <a asp-page="./Delete" asp-route-id="@Model.Session.Id" class="btn btn-outline-secondary">Удалить</a>
        <a asp-page="./Index" class="btn btn-outline-secondary">Назад к списку</a>
    </div>
</div>

@if (Model.SeatLayout.Any())
{
    <div class="details-container">
        <h3 class="mb-4">Схема зала</h3>

        <div class="cinema-screen mb-4">
            <div class="screen-label">ЭКРАН</div>
        </div>

        <div class="d-flex gap-4 mb-4 flex-wrap justify-content-center">
            <div class="legend-item">
                <span class="seat-circle available"></span>
                <span>Свободно</span>
            </div>
            <div class="legend-item">
                <span class="seat-circle occupied"></span>
                <span>Занято</span>
            </div>
        </div>

        @{
            var maxRow = Model.SeatLayout.Max(s => s.RowNumber);
            var maxSeat = Model.SeatLayout.Max(s => s.SeatNumber);
        }

        <div class="seats-container">
            @for (int row = 1; row <= maxRow; row++)
            {
                var rowSeats = Model.SeatLayout.Where(s => s.RowNumber == row).OrderBy(s => s.SeatNumber).ToList();
                <div class="seat-row">
                    <div class="row-label">Ряд @row</div>
                    <div class="seats">
                        @for (int seatNum = 1; seatNum <= maxSeat; seatNum++)
                        {
                            var seat = rowSeats.FirstOrDefault(s => s.SeatNumber == seatNum);
                            if (seat != null)
                            {
                                <div class="seat-circle @(seat.IsOccupied ? "occupied" : "available")" 
                                     title="Ряд @seat.RowNumber, Место @seat.SeatNumber - @(seat.IsOccupied ? "Занято" : "Свободно")">
                                    @seat.SeatNumber
                                </div>
                            }
                            else
                            {
                                <div class="seat-circle invisible">-</div>
                            }
                        }
                    </div>
                </div>
            }
        </div>
    </div>
}
